<?xml version="1.0" encoding="ISO-8859-1"?>
<DBSCRIPT desc="Creacion SKU-centro desde demanda" author="" date="">

<!--Crea SKU_CENTRO desde registros en demanda, lo hace solo para todos los centro registrados en la centro.
	
	Toma un registro de demanda y busca el codigo_interno de su SKU. A partir de este saca todos los SKU que contengan el mismo codigo_interno.
	Esto es, rescata toda la cadena de reemplazo del SKU. Asigna a todos los centros existentes en CENTRO a SKU_CENTRO, para cada SKU encontrado.
-->
<SQL db="STOCKDOWN" id="crea sku_centro desde demanda" desc="Crea sku_centro desde demanda"  enable="1"><![CDATA[

INSERT INTO sku_centro
(codigo_sku,codigo_centro)
SELECT z2.codigo_sku,z2.codigo_centro
FROM
(
SELECT z1.codigo_sku,c.codigo_centro FROM
(
SELECT s2.codigo_sku
FROM demanda d, sku s, sku s2
WHERE d.codigo_sku=s.codigo_sku
AND s.codigo_interno=s2.codigo_interno
GROUP BY s2.codigo_sku
) z1, centro c
) z2 LEFT JOIN sku_centro sc
ON z2.codigo_sku=sc.codigo_sku
AND z2.codigo_centro=sc.codigo_centro
WHERE sc.codigo_sku is null
]]></SQL>

</DBSCRIPT>