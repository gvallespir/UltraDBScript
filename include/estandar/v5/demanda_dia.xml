<?xml version="1.0" encoding="ISO-8859-1"?>
<DBSCRIPT desc="Actualización de DEMANDA_DIA" author="" date="">

<SQL db="STOCKDOWN" id="Actualiza DEMANDA_DIA desde etl_demanda_dtl" desc="Actualiza DEMANDA_DIA desde etl_demanda_dtl" ><![CDATA[
UPDATE demanda_dia,
(
	SELECT
	t.codigo_sku,t.codigo_centro,t.fecha
	,sum(t.cantidad) as cantidad
	,sum(t.numero_lineas) as numero_lineas
	,sum(t.monto) as monto_venta
	FROM etl_demanda_dtl t
	GROUP BY
	t.codigo_sku,t.codigo_centro,t.fecha
) zz
SET demanda_dia.cantidad=zz.cantidad
, demanda_dia.monto_venta=zz.monto_venta
WHERE demanda_dia.codigo_sku=zz.codigo_sku
AND demanda_dia.codigo_centro=zz.codigo_centro
AND demanda_dia.fecha=zz.fecha
]]></SQL>

<SQL db="STOCKDOWN" id="insert DEMANDA_DIA desde etl_demanda_dtl" desc="Agrega DEMANDA_DIA desde etl_demanda_dtl" ><![CDATA[
INSERT INTO demanda_dia
(codigo_sku,codigo_centro,fecha,cantidad,monto_venta)
SELECT zz.codigo_sku,zz.codigo_centro,zz.fecha,zz.cantidad,zz.monto_venta
FROM
(
	SELECT
	t.codigo_sku,t.codigo_centro,t.fecha
	,sum(t.cantidad) as cantidad
	,sum(t.numero_lineas) as numero_lineas
	,sum(t.monto) as monto_venta
	FROM etl_demanda_dtl t
	GROUP BY
	t.codigo_sku,t.codigo_centro,t.fecha
) zz LEFT JOIN
demanda_dia d ON
d.codigo_sku=zz.codigo_sku AND d.codigo_centro=zz.codigo_centro AND d.fecha=zz.fecha
WHERE d.codigo_sku is null
]]></SQL>

</DBSCRIPT>