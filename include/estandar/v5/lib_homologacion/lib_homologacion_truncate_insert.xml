<?xml version="1.0" encoding="ISO-8859-1" ?>
<DBSCRIPT desc="Migración con homologación">
<!--
Este XML debe tener predefinida una SQL_METADATA, la cual tiene la estructura
posicion: ordenamiento para group_concat
extra_join: joins adicionales para construir la query
campo_insert: campos a incluir en insert
campo_select: campos a incluir en select

Este XML recibe un conjunto de parametros 
El USO de este XML depende de que se tengan predefinidos parametros
VAR_BD_ORIGEN:  Base de datos de origen
VAR_BD_DESTINO:  Base de datos de destino
VAR_TABLA_ORIGEN: Tabla de origen
VAR_TABLA_DESTINO: Tabla de destino
VAR_EJECUTAR: Ejecutar migración

En base a lo anterior trunca e inserta datos homologados desde origen a destino
-->

<PARAM id="EXTRA_JOIN" value="" db="STOCKDOWN"  sqlvalue="SELECT
GROUP_CONCAT(t.extra_join ORDER BY t.posicion SEPARATOR ' ') as extra_join
FROM (%SQL_METADATA%) t
"/>

<PARAM id="CAMPO_INSERT" value="" db="STOCKDOWN"  sqlvalue="SELECT
GROUP_CONCAT(t.campo_insert ORDER BY t.posicion SEPARATOR ',') as campo_insert
FROM (%SQL_METADATA%) t
"/>

<PARAM id="CAMPO_SELECT" value="" db="STOCKDOWN"  sqlvalue="SELECT
GROUP_CONCAT(t.campo_select ORDER BY t.posicion SEPARATOR ',') as campo_select
FROM (%SQL_METADATA%) t
"/>

<PARAM id="SQL_SELECT" value="
SELECT
%CAMPO_SELECT%
FROM %VAR_BD_ORIGEN%.%VAR_TABLA_ORIGEN% t 
%EXTRA_JOIN%
"/>

<PARAM id="SQL_TRUNCATE" value="
TRUNCATE TABLE %VAR_BD_DESTINO%.%VAR_TABLA_DESTINO%
"/>

<PARAM id="SQL_INSERT" value="
INSERT INTO %VAR_BD_DESTINO%.%VAR_TABLA_DESTINO%
(%CAMPO_INSERT%)
SELECT
%CAMPO_SELECT%
FROM %VAR_BD_ORIGEN%.%VAR_TABLA_ORIGEN% t 
%EXTRA_JOIN%
"/>

<SQL db="STOCKDOWN" id="Limpia %VAR_BD_DESTINO%.%VAR_TABLA_DESTINO%" enabled="%VAR_EJECUTAR%" ><![CDATA[
%SQL_TRUNCATE%
]]></SQL>

<SQL db="STOCKDOWN" id="Llena %VAR_BD_DESTINO%.%VAR_TABLA_DESTINO%" enabled="%VAR_EJECUTAR%" ><![CDATA[
%SQL_INSERT%
]]></SQL>

</DBSCRIPT>