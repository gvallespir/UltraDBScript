<?xml version="1.0" encoding="ISO-8859-1"?>
<DBSCRIPT>

<!--
Encuentra las tablas UPL que tenga el campo z_id_busqueda
Obtiene del information_schema la clave primaria y actualiza CAMPO_BUSQUEDA con el concat de las claves_primarias
-->
<PARAM id="FILTRO_SQL" value="AND t.COLUMN_NAME='%CAMPO_BUSQUEDA%' AND t.table_name like 'upl_%'" />

<SQL id="aumenta el maximo largo de group concat" db="STOCKDOWN" desc="" enabled="1"><![CDATA[
SET SESSION group_concat_max_len = 10000000
]]></SQL>

<ITERATION id="Obtiene parametros de rutas" token="$" max_tasks="%MAX_TASKS%" >
<SOURCE >
<SQL id="Obtiene colecciones de valor rutas" db="STOCKDOWN" desc="" enabled="1"><![CDATA[
SELECT t.table_name 
FROM information_schema.columns t
WHERE t.TABLE_SCHEMA=database()
%FILTRO_SQL%
]]></SQL>
</SOURCE >
<PROCESS logleve="2" >

<PARAM id="UPDATE_SQL" value="" db="STOCKDOWN" sqlvalue="SELECT concat('concat(',group_concat(t.column_name ORDER BY t.ORDINAL_POSITION SEPARATOR ',char(124),'),')') FROM information_schema.columns t WHERE t.TABLE_SCHEMA=database() AND t.table_name like '$table_name$' AND t.COLUMN_KEY='PRI'" />
<SQL id="disable keys $table_name$" db="STOCKDOWN" enabled="%enable_upl_almacen%" ><![CDATA[ALTER TABLE $table_name$ DISABLE KEYS]]></SQL>
<SQL id="Actualiza $table_name$.%CAMPO_BUSQUEDA%" db="STOCKDOWN" desc="" enabled="1"><![CDATA[
UPDATE $table_name$
SET %CAMPO_BUSQUEDA%=%UPDATE_SQL%
]]></SQL>
<SQL id="enable keys $table_name$" db="STOCKDOWN" enabled="%enable_upl_almacen%" ><![CDATA[ALTER TABLE $table_name$ ENABLE KEYS]]></SQL>

</PROCESS>
</ITERATION>

</DBSCRIPT>
