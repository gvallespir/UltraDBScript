<?xml version="1.0" encoding="ISO-8859-1" ?>
<DBSCRIPT desc="Llenado ops_tabla_historico">
<!--
El USO de este XML depende de que se tengan predefinidos 3 parametros
OPS_FECHA: Fecha de registro histórico
OPS_CATALOG: Nombre del catalogo en information_schema
OPS_DATABASE: Nombre de la base de datos en information_schema
-->
<SQL db="STOCKDOWN" id="DELETE FROM ops_tabla_historico" desc="vacia tabla ops_tabla_historico"><![CDATA[
DELETE FROM ops_tabla_historico WHERE nombre_servidor=%OPS_SERVIDOR% AND fecha=%OPS_FECHA% AND nombre_base_dato=%OPS_DATABASE%
]]></SQL>

<SQL db="STOCKDOWN" id="INSERT INTO ops_tabla_historico" desc="llena tabla ops_tabla_historico"><![CDATA[
INSERT INTO ops_tabla_historico
(
nombre_servidor
,fecha
,nombre_base_dato
,nombre_tabla
,tamano_dato_mb
,tamano_indice_mb
,numero_registros
,fecha_actualizacion
)
SELECT
%OPS_SERVIDOR% as nombre_servidor
,%OPS_FECHA% as fecha
,t2.table_schema nombre_base_dato 
,t2.table_name nombre_tabla 
,round((t2.data_length)/(1024*1024),2) as tamano_dato_mb 
,round((t2.index_length)/(1024*1024),2) as tamano_indice_mb 
,ifnull(t2.table_rows,0) as numero_registros 
,t2.update_time as fecha_actualizacion 
FROM information_schema.tables t2
WHERE t2.table_catalog=%OPS_CATALOG%
AND t2.table_schema=%OPS_DATABASE%
]]></SQL>

</DBSCRIPT>