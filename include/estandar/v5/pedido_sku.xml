<?xml version="1.0" encoding="ISO-8859-1"?>
<DBSCRIPT desc="Actualización de PEDIDO_SKU" author="" date="">

<SQL db="STOCKDOWN" id="borra pedido" desc="borra pedido"><![CDATA[
DELETE FROM pedido_sku WHERE estado=0
]]></SQL>

<SQL db="STOCKDOWN" id="borra pedido eliminado" desc="borra pedido eliminado"><![CDATA[
 DELETE pedido_sku FROM pedido_sku INNER JOIN etl_pedido_sku ON
 pedido_sku.codigo_pedido = etl_pedido_sku.codigo_pedido AND
 pedido_sku.codigo_sku = etl_pedido_sku.codigo_sku AND
 pedido_sku.codigo_centro = etl_pedido_sku.codigo_centro AND
 pedido_sku.tipo_pedido = etl_pedido_sku.tipo_pedido 
 WHERE etl_pedido_sku.eliminado=0
]]></SQL>

 <SQL db="STOCKDOWN" id="borra pedido que cambiaron de estado" desc="borra pedido que cambiaron de estado"><![CDATA[ 
 DELETE pedido_sku FROM pedido_sku INNER JOIN etl_pedido_sku ON
 pedido_sku.codigo_pedido = etl_pedido_sku.codigo_pedido AND
 pedido_sku.codigo_sku = etl_pedido_sku.codigo_sku AND
 pedido_sku.codigo_centro = etl_pedido_sku.codigo_centro AND
 pedido_sku.tipo_pedido = etl_pedido_sku.tipo_pedido 
 WHERE pedido_sku.estado=1
 AND etl_pedido_sku.estado=0
]]></SQL>

<SQL db="STOCKDOWN" id=" inserta nuevos pedidos" desc="inserta nuevos pedidos"><![CDATA[
insert into pedido_sku
(codigo_pedido,codigo_sku,codigo_centro,codigo_proveedor,tipo_pedido,fecha_creacion,cantidad_pedida,cantidad_pendiente
,estado,fecha_arribo,fecha_estimada_arribo
,id_linea_pedido, id_solicitud, id_linea_solicitud, fecha_solicitud)
select
z.codigo_pedido,z.codigo_sku,z.codigo_centro,z.codigo_proveedor,
z.tipo_pedido,z.fecha_creacion,z.cantidad_pedida,z.cantidad_pendiente,
z.estado,z.fecha_arribo,z.fecha_estimada_arribo,
z.id_linea_pedido, z.id_solicitud, z.id_linea_solicitud, z.fecha_solicitud
from etl_pedido_sku z
where z.estado=0
AND z.eliminado=0
]]></SQL>

<SQL db="STOCKDOWN" id="inserta nuevos pedidos cerrados" desc="inserta nuevos pedidos cerrados">
<![CDATA[ 
insert into pedido_sku
(codigo_pedido,codigo_sku,codigo_centro,codigo_proveedor,tipo_pedido,fecha_creacion,cantidad_pedida,cantidad_pendiente
,estado,fecha_arribo,fecha_estimada_arribo
,id_linea_pedido, id_solicitud, id_linea_solicitud, fecha_solicitud)
select
z.codigo_pedido,z.codigo_sku,z.codigo_centro,z.codigo_proveedor,
z.tipo_pedido,z.fecha_creacion,z.cantidad_pedida,z.cantidad_pendiente,
z.estado,z.fecha_arribo,z.fecha_estimada_arribo,
z.id_linea_pedido, z.id_solicitud, z.id_linea_solicitud, z.fecha_solicitud
from etl_pedido_sku z
LEFT JOIN pedido_sku ps ON z.codigo_pedido=ps.codigo_pedido AND z.codigo_sku=ps.codigo_sku AND z.codigo_centro=ps.codigo_centro AND z.tipo_pedido=ps.tipo_pedido 
where z.estado=1
AND ps.codigo_sku is null
AND z.eliminado=0
]]> 
</SQL>
  
<SQL db="STOCKDOWN" id="actualiza antigüos pedidos" desc="actualiza antigüos pedidos">
<![CDATA[ 
update pedido_sku, etl_pedido_sku
set
 pedido_sku.codigo_proveedor=etl_pedido_sku.codigo_proveedor
,pedido_sku.fecha_creacion=etl_pedido_sku.fecha_creacion
,pedido_sku.cantidad_pedida=etl_pedido_sku.cantidad_pedida
,pedido_sku.cantidad_pendiente=etl_pedido_sku.cantidad_pendiente
,pedido_sku.estado=etl_pedido_sku.estado
,pedido_sku.fecha_arribo=etl_pedido_sku.fecha_arribo
,pedido_sku.fecha_estimada_arribo=etl_pedido_sku.fecha_estimada_arribo
,pedido_sku.id_linea_pedido=etl_pedido_sku.id_linea_pedido
,pedido_sku.id_solicitud=etl_pedido_sku.id_solicitud
,pedido_sku.id_linea_solicitud=etl_pedido_sku.id_linea_solicitud
,pedido_sku.fecha_solicitud=etl_pedido_sku.fecha_solicitud

where
pedido_sku.codigo_pedido=etl_pedido_sku.codigo_pedido AND
pedido_sku.codigo_sku=etl_pedido_sku.codigo_sku AND
pedido_sku.codigo_centro=etl_pedido_sku.codigo_centro AND
pedido_sku.tipo_pedido=etl_pedido_sku.tipo_pedido
AND etl_pedido_sku.eliminado=0
]]> 
</SQL>

</DBSCRIPT>