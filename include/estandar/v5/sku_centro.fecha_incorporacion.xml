<?xml version="1.0" encoding="ISO-8859-1"?>
<DBSCRIPT desc="Actualiza fecha de creación" author="" date="">

<!--
En caso que no exista fecha de incorporacion la saca de demanda, si existe se toma el menor valor entre demanda y sku_centro.fecha_incorporacion
-->
<SQL db="STOCKDOWN" id="Update SKU_CENTRO fecha_incorporacion" desc="Actualiza SKU_CENTRO fecha_incorporacion "><![CDATA[
UPDATE sku_centro
SET
sku_centro.fecha_incorporacion=
CASE WHEN sku_centro.fecha_incorporacion is null THEN
(SELECT min(z.fecha)
 FROM demanda z
 WHERE
 z.codigo_sku=sku_centro.codigo_sku AND
 z.codigo_centro=sku_centro.codigo_centro)
ELSE least(sku_centro.fecha_incorporacion,
ifnull((SELECT min(z.fecha)
 FROM demanda z
 WHERE
 z.codigo_sku=sku_centro.codigo_sku AND
 z.codigo_centro=sku_centro.codigo_centro),sku_centro.fecha_incorporacion)
) END
]]></SQL>

</DBSCRIPT>